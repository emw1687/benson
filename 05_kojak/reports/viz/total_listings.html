<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Number of Listings by City</title>
        <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
        <style type="text/css">
        p {
          display: inline;
        }
        </style>
    </head>
    <body>
        <p id=apartment>Apartments</p> <p id=castle>Castles</p> <p id=all>Reset</p>
        <!-- <p>Click on this text to update the chart with new data values!</p> -->
        <script type="text/javascript">
            // Your beautiful D3 code will go here

            //svg width and height
            var w = 900;
            var h = 600;

            //create svg
            var svg = d3.select("body")
                        .append("svg")
                        .attr("width", w)
                        .attr("height", h);

            var projection = d3.geo.albersUsa();

            var path = d3.geo.path().projection(projection);

              //map us
              d3.json("data/us.json", function(json) {

                svg.selectAll("path")
                   .data(json.features)
                   .enter()
                   .append("path")
                   .attr("d", path)
                   .attr("fill", "grey");

                 //map cities and their total listings
                 d3.csv("data/city_pcts.csv", function(data) {

                   //create circles, one for each city in dataset
                   var circles = svg.selectAll("circle")
                                    .data(data)
                                    .enter()
                                    .append("circle");

                    //scale for circles
                    var circle_scale = 20

                    //add attributes to circles
                    //cx, cy = lat/long
                    //r = sqrt(number of listings * pi)
                    circles.attr("cx", function(d) { return projection([d.lng, d.lat])[0]; })
                           .attr("cy", function(d) { return projection([d.lng, d.lat])[1]; })
                           .attr("r", function (d) { return Math.sqrt(d.pct_total_listings) * 3.14 * circle_scale })
                           .style("fill", "blue")
                           .style("opacity", 0.80);

                     //add functionality to 'apartment' (change to apartment data on click)
                     //function to update circle sizes based on property types

                     var prop_update = function(id, csv_header) {
                           d3.select(id)
                              .on("click", function() {
                                var circles = svg.selectAll("circle")
                                             .data(data)
                                             .transition()
                                             .duration(500)
                                             .attr("r", function (d) { return Math.sqrt(d[csv_header]) * 3.14 * circle_scale })
                                             .style("fill", "yellow");
                           });

                     };

                     prop_update("#apartment", "apartment");
                     prop_update("#castle", "castle");
                     prop_update("#all", "pct_total_listings");

                   });


              });


            /*
            //create scales and axes
            var xpadding = 0.1 * w;
            var ypadding = 0.1 * h;

            //create scales and axes
            var xscale = d3.scaleLinear()
                                 .domain([0, d3.max(dataset, function(d) {return d[0];})])
                                 .range([xpadding, w-xpadding]);

            var yscale = d3.scaleLinear()
                                 .domain([0, d3.max(dataset, function(d) {return d[1];})])
                                 .range([h - ypadding, ypadding])

            var xaxis = d3.axisBottom()
                          .scale(xscale)
                          .ticks(5);

            var yaxis = d3.axisLeft()
                          .scale(yscale)
                          .ticks(5);

            //create circles
            var circles = svg.selectAll("circle")
                            .data(dataset)
                            .enter()
                            .append("circle")
                            .attr("cx", function(d) {return xscale(d[0]);})
                            .attr("cy", function(d) {return yscale(d[1]);})
                            .attr("r", 10)
                            .style("fill", "grey");

            //create group, draw axes
            svg.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(0," + (h-ypadding) + ")")
                .call(xaxis);

            svg.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(" + xpadding + ", 0)")
                .call(yaxis);
            */

        </script>
    </body>
</html>
