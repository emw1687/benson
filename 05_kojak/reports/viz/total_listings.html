<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Number of Listings by City</title>
        <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
        <style type="text/css">
        p {
          display: inline;
        }
        </style>
    </head>
    <body>

        <script type="text/javascript">

            //property types
            var prop_types = [
              ["apartment", "Apartments"],
              ["bed&breakfast", "Bed & Breakfasts"],
              ["boat", "Boats"],
              ["boutiquehotel", "Boutique Hotels"],
              ["bungalow", "Bungalows"],
              ["cabin", "Cabins"],
              ["camperrv", "Campers/RVs"],
              ["castle", "Castles"],
              ["cave", "Caves"],
              ["chalet", "Chalets"],
              ["condominium", "Condominiums"],
              ["dorm", "Dorms"],
              ["earthhouse", "Earthouses"],
              ["entirefloor", "Entire Floors"],
              ["guesthouse", "Guesthouses"],
              ["hostel", "Hostels"],
              ["house", "Houses"],
              ["hut", "Huts"],
              ["island", "Islands"],
              ["lighthouse", "Lighthouses"],
              ["loft", "Lofts"],
              ["other", "Other"],
              ["plane", "Planes"],
              ["tent", "Tents"],
              ["timeshare", "Timeshares"],
              ["tipi", "Tipis"],
              ["townhouse", "Townhouses"],
              ["train", "Trains"],
              ["treehouse", "Treehouses"],
              ["villa", "Villas"],
              ["yurt", "Yurts"],
              ["pct_total_listings", "Reset"]
            ];

            //create buttons
            d3.select("body").selectAll("input")
              .data(prop_types)
              .enter()
              .append("input")
              .attr("type", "button")
              .attr("id", function(d) { return d[0]; })
              .attr("value", function(d) { return d[1]; });

            //svg width and height
            var w = 900;
            var h = 600;

            //create svg
            var svg = d3.select("body")
                        .append("svg")
                        .attr("width", w)
                        .attr("height", h);

            var projection = d3.geo.albersUsa();

            var path = d3.geo.path().projection(projection);

              //add map of us
              d3.json("data/us.json", function(json) {

                svg.selectAll("path")
                   .data(json.features)
                   .enter()
                   .append("path")
                   .attr("d", path)
                   .attr("fill", "grey");

                 //add cities and their listings data
                 d3.csv("data/city_pcts.csv", function(data) {

                   //create circles, one for each city in dataset
                   var circles = svg.selectAll("circle")
                                    .data(data)
                                    .enter()
                                    .append("circle");

                    //scale for circles
                    var circle_scale = 20
                    var opacity_scale = 5

                    //add attributes to circles
                    //cx, cy = lat/long
                    //r = sqrt(number of listings * pi)
                    circles.attr("cx", function(d) { return projection([d.lng, d.lat])[0]; })
                           .attr("cy", function(d) { return projection([d.lng, d.lat])[1]; })
                           .attr("r", function (d) { return Math.sqrt(d.pct_total_listings) * 3.14 * circle_scale })
                           .style("fill", "blue")
                           .style("opacity", function (d) { return d.pct_total_listings**(3/4) * opacity_scale });

                     //update data on button click
                     d3.selectAll("input")
                        .on("click", function() {
                          csv_header = this.id;
                          var circles = svg.selectAll("circle")
                                       .data(data)
                                       .transition()
                                       .duration(500)
                                       .attr("r", function (d) { return Math.sqrt(d[csv_header]) * 3.14 * circle_scale })
                                       .style("fill", "purple")
                                       .style("opacity", function (d) {return d[csv_header]**(3/4) * opacity_scale });
                        });

                   });

              });

        </script>
    </body>
</html>
